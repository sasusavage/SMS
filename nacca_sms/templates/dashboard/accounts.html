{% extends "layouts/dashboard.html" %}

{% block title %}Accounts Dashboard - NaCCA SMS{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">Accounts Dashboard</h1>
    <p class="page-subtitle">Financial overview for the current term</p>
</div>

<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2">
                <circle cx="12" cy="12" r="10" />
                <path d="M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8" />
                <path d="M12 18V6" />
            </svg>
        </div>
        <div class="stat-value">GHS {{ "{:,.0f}".format(stats.fees_expected) }}</div>
        <div class="stat-label">Expected This Term</div>
    </div>

    <div class="stat-card success">
        <div class="stat-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
                <polyline points="22 4 12 14.01 9 11.01" />
            </svg>
        </div>
        <div class="stat-value">GHS {{ "{:,.0f}".format(stats.fees_collected) }}</div>
        <div class="stat-label">Collected</div>
    </div>

    <div class="stat-card error">
        <div class="stat-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2">
                <circle cx="12" cy="12" r="10" />
                <line x1="15" y1="9" x2="9" y2="15" />
                <line x1="9" y1="9" x2="15" y2="15" />
            </svg>
        </div>
        <div class="stat-value">GHS {{ "{:,.0f}".format(stats.fees_outstanding) }}</div>
        <div class="stat-label">Outstanding</div>
    </div>

    <div class="stat-card warning">
        <div class="stat-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                <line x1="16" y1="2" x2="16" y2="6" />
                <line x1="8" y1="2" x2="8" y2="6" />
                <line x1="3" y1="10" x2="21" y2="10" />
            </svg>
        </div>
        <div class="stat-value">GHS {{ "{:,.0f}".format(stats.today_collected) }}</div>
        <div class="stat-label">Collected Today</div>
    </div>
</div>

<div style="display: grid; grid-template-columns: 2fr 1fr; gap: var(--space-6);">
    <!-- Debtors List -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Top Debtors</h3>
            <a href="{{ url_for('fees.debtors') }}" class="btn btn-ghost btn-sm">View All</a>
        </div>
        <div class="card-body" style="padding: 0;">
            <div class="table-wrapper">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Student</th>
                            <th>Balance</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for inv in debtors %}
                        <tr>
                            <td>
                                <div style="font-weight: 500;">{{ inv.student.full_name }}</div>
                                <div style="font-size: var(--font-size-xs); color: var(--slate-500);">{{
                                    inv.invoice_number }}</div>
                            </td>
                            <td style="color: var(--error-500); font-weight: 600;">GHS {{ "{:,.2f}".format(inv.balance)
                                }}</td>
                            <td>
                                <a href="{{ url_for('fees.record_payment', invoice_id=inv.id) }}"
                                    class="btn btn-ghost btn-sm">Pay</a>
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="3"
                                style="text-align: center; color: var(--slate-500); padding: var(--space-6);">
                                No outstanding balances
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Quick Actions</h3>
        </div>
        <div class="card-body">
            <div style="display: flex; flex-direction: column; gap: var(--space-3);">
                <a href="{{ url_for('fees.record_payment') }}" class="btn btn-primary"
                    style="justify-content: flex-start;">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2" width="18" height="18">
                        <circle cx="12" cy="12" r="10" />
                        <path d="M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8" />
                    </svg>
                    Record Payment
                </a>
                <a href="{{ url_for('fees.invoices') }}" class="btn btn-secondary" style="justify-content: flex-start;">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2" width="18" height="18">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                        <polyline points="14 2 14 8 20 8" />
                    </svg>
                    View Invoices
                </a>
                <a href="{{ url_for('fees.debtors') }}" class="btn btn-secondary" style="justify-content: flex-start;">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2" width="18" height="18">
                        <path
                            d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z" />
                    </svg>
                    Debtors List
                </a>
                <a href="{{ url_for('fees.payments') }}" class="btn btn-secondary" style="justify-content: flex-start;">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2" width="18" height="18">
                        <line x1="12" y1="1" x2="12" y2="23" />
                        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" />
                    </svg>
                    Payment History
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Today's Payments -->
<div class="card" style="margin-top: var(--space-6);">
    <div class="card-header">
        <h3 class="card-title">Today's Payments</h3>
    </div>
    <div class="card-body" style="padding: 0;">
        <div class="table-wrapper">
            <table class="table">
                <thead>
                    <tr>
                        <th>Receipt #</th>
                        <th>Student</th>
                        <th>Amount</th>
                        <th>Method</th>
                        <th>Time</th>
                    </tr>
                </thead>
                <tbody>
                    {% for pay in today_payments %}
                    <tr>
                        <td><code style="color: var(--primary-400);">{{ pay.receipt_number }}</code></td>
                        <td>{{ pay.invoice.student.full_name }}</td>
                        <td style="font-weight: 600; color: var(--success-500);">GHS {{ "{:,.2f}".format(pay.amount) }}
                        </td>
                        <td><span class="badge badge-neutral">{{ pay.payment_method.value|title }}</span></td>
                        <td style="color: var(--slate-400);">{{ pay.payment_date.strftime('%H:%M') }}</td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="5" style="text-align: center; color: var(--slate-500); padding: var(--space-6);">
                            No payments recorded today
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}