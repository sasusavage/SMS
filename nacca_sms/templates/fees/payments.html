{% extends "layouts/dashboard.html" %}

{% block title %}Payments - NaCCA SMS{% endblock %}

{% block breadcrumb %}
<nav class="breadcrumb">
    <a href="{{ url_for('dashboard.index') }}">Dashboard</a>
    <span class="breadcrumb-separator">/</span>
    <span class="breadcrumb-current">Payments</span>
</nav>
{% endblock %}

{% block content %}
<div class="page-header" style="display: flex; justify-content: space-between; align-items: flex-start;">
    <div>
        <h1 class="page-title">Payment History</h1>
        <p class="page-subtitle">View all recorded payments</p>
    </div>
    <a href="{{ url_for('fees.record_payment') }}" class="btn btn-primary">Record Payment</a>
</div>

<div class="card">
    <div class="card-body" style="padding: 0;">
        <div class="table-wrapper">
            <table class="table">
                <thead>
                    <tr>
                        <th>Receipt #</th>
                        <th>Date</th>
                        <th>Student</th>
                        <th>Invoice</th>
                        <th style="text-align: right;">Amount</th>
                        <th>Method</th>
                        <th>Received By</th>
                    </tr>
                </thead>
                <tbody>
                    {% for payment in payments.items %}
                    <tr>
                        <td><code style="color: var(--primary-400);">{{ payment.receipt_number }}</code></td>
                        <td>{{ payment.payment_date.strftime('%b %d, %Y') }}</td>
                        <td style="font-weight: 500;">{{ payment.invoice.student.full_name }}</td>
                        <td>
                            <a href="{{ url_for('fees.view_invoice', id=payment.invoice_id) }}"
                                style="color: var(--primary-400);">
                                {{ payment.invoice.invoice_number }}
                            </a>
                        </td>
                        <td style="text-align: right; font-weight: 600; color: var(--success-500);">
                            GHS {{ "{:,.2f}".format(payment.amount) }}
                        </td>
                        <td><span class="badge badge-secondary">{{ payment.payment_method.value|title }}</span></td>
                        <td>{{ payment.received_by.email if payment.received_by else '-' }}</td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="7" style="text-align: center; padding: var(--space-8); color: var(--slate-500);">
                            No payments recorded
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Pagination -->
{% if payments.pages > 1 %}
<div style="display: flex; justify-content: center; gap: var(--space-2); margin-top: var(--space-5);">
    {% for page in payments.iter_pages() %}
    {% if page %}
    <a href="{{ url_for('fees.payments', page=page) }}"
        class="btn {{ 'btn-primary' if page == payments.page else 'btn-ghost' }} btn-sm">{{ page }}</a>
    {% else %}
    <span style="color: var(--slate-500);">...</span>
    {% endif %}
    {% endfor %}
</div>
{% endif %}
{% endblock %}