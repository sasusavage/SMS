{% extends "layouts/dashboard.html" %}

{% block title %}Record Payment - NaCCA SMS{% endblock %}

{% block breadcrumb %}
<nav class="breadcrumb">
    <a href="{{ url_for('dashboard.index') }}">Dashboard</a>
    <span class="breadcrumb-separator">/</span>
    <a href="{{ url_for('fees.invoices') }}">Fees</a>
    <span class="breadcrumb-separator">/</span>
    <a href="{{ url_for('fees.view_invoice', id=invoice.id) }}">{{ invoice.invoice_number }}</a>
    <span class="breadcrumb-separator">/</span>
    <span class="breadcrumb-current">Record Payment</span>
</nav>
{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">Record Payment</h1>
    <p class="page-subtitle">Recording payment for {{ invoice.student.full_name }}</p>
</div>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-6);">
    <!-- Payment Form -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Payment Details</h3>
        </div>
        <form method="POST" action="{{ url_for('fees.record_payment', invoice_id=invoice.id) }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <div class="card-body">
                <div class="form-group">
                    <label class="form-label" for="amount">Amount (GHS) *</label>
                    <input type="number" id="amount" name="amount" class="form-input" step="0.01" min="0.01"
                        max="{{ invoice.balance }}" value="{{ invoice.balance }}" required>
                    <div style="font-size: var(--font-size-xs); color: var(--slate-500); margin-top: var(--space-1);">
                        Maximum: GHS {{ "{:,.2f}".format(invoice.balance) }}
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label" for="payment_method">Payment Method *</label>
                    <select id="payment_method" name="payment_method" class="form-select" required>
                        <option value="cash">Cash</option>
                        <option value="bank_transfer">Bank Transfer</option>
                        <option value="mobile_money">Mobile Money</option>
                        <option value="cheque">Cheque</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label" for="reference_number">Reference/Receipt Number</label>
                    <input type="text" id="reference_number" name="reference_number" class="form-input"
                        placeholder="e.g. MTN-123456789">
                </div>

                <div class="form-group">
                    <label class="form-label" for="payment_date">Payment Date *</label>
                    <input type="date" id="payment_date" name="payment_date" class="form-input" value="{{ today }}"
                        required>
                </div>

                <div class="form-group">
                    <label class="form-label" for="notes">Notes</label>
                    <textarea id="notes" name="notes" class="form-textarea" rows="2"></textarea>
                </div>
            </div>
            <div class="card-footer" style="display: flex; justify-content: flex-end; gap: var(--space-3);">
                <a href="{{ url_for('fees.view_invoice', id=invoice.id) }}" class="btn btn-ghost">Cancel</a>
                <button type="submit" class="btn btn-success">Record Payment</button>
            </div>
        </form>
    </div>

    <!-- Invoice Summary -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Invoice Summary</h3>
        </div>
        <div class="card-body">
            <div style="margin-bottom: var(--space-5);">
                <div style="font-size: var(--font-size-xs); color: var(--slate-500); margin-bottom: var(--space-1);">
                    Invoice Number</div>
                <code
                    style="color: var(--primary-400); font-size: var(--font-size-lg);">{{ invoice.invoice_number }}</code>
            </div>

            <div
                style="display: flex; align-items: center; gap: var(--space-3); margin-bottom: var(--space-5); padding: var(--space-4); background: var(--slate-800); border-radius: var(--radius-lg);">
                <div class="user-avatar">{{ invoice.student.first_name[0] }}{{ invoice.student.last_name[0] }}</div>
                <div>
                    <div style="font-weight: 600;">{{ invoice.student.full_name }}</div>
                    <div style="font-size: var(--font-size-sm); color: var(--slate-400);">{{
                        invoice.student.current_class.name if invoice.student.current_class else '' }}</div>
                </div>
            </div>

            <div style="border-top: 1px solid var(--slate-800); padding-top: var(--space-4);">
                <div style="display: flex; justify-content: space-between; padding: var(--space-2) 0;">
                    <span style="color: var(--slate-400);">Total Amount</span>
                    <span style="font-weight: 600;">GHS {{ "{:,.2f}".format(invoice.total_amount) }}</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: var(--space-2) 0;">
                    <span style="color: var(--success-500);">Already Paid</span>
                    <span style="font-weight: 600; color: var(--success-500);">GHS {{
                        "{:,.2f}".format(invoice.amount_paid) }}</span>
                </div>
                <div
                    style="display: flex; justify-content: space-between; padding: var(--space-3) 0; border-top: 1px solid var(--slate-800); margin-top: var(--space-2);">
                    <span style="font-weight: 600; color: var(--error-500);">Balance Due</span>
                    <span style="font-weight: 700; font-size: var(--font-size-xl); color: var(--error-500);">GHS {{
                        "{:,.2f}".format(invoice.balance) }}</span>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}